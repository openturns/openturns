on:
  pull_request:
jobs:
  build:
    runs-on: macos-latest
    env:
      LDFLAGS: -L/usr/local/opt/openblas/lib
      CPPFLAGS: -I/usr/local/opt/openblas/include
    steps:
    - uses: actions/checkout@v2
    - run: brew upgrade
    - run: brew install openblas boost tbb bison flex r 
    - run:  |
        cmake -DR_EXECUTABLE="dummyR" -DBUILD_PYTHON=OFF \
        -DCMAKE_C_FLAGS="-O0" -DCMAKE_CXX_FLAGS="-O1" \
        -DFLEX_EXECUTABLE=/usr/local/opt/flex/bin/flex \
        -DBISON_EXECUTABLE=/usr/local/opt/bison/bin/bison \
        -DSPECTRA_INCLUDE_DIR=/Users/runner/include \
        -DCMAKE_UNITY_BUILD=ON -DCMAKE_UNITY_BUILD_BATCH_SIZE=32 .
    - run: make t_GeneralizedParetoFactory_std -j$(sysctl -n hw.logicalcpu)
    - run: ctest -R cppcheck_GeneralizedParetoFactory_std --output-on-failure --timeout 100
